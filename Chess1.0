#include <iostream>
#include <string>
#include <unistd.h>
using namespace std;

int main()
{
    string map [8][8];
    string eingabe ="";
    int von,nach,von1,nach1,color=0;

    string boxLines = "════════╦";

    system("@chcp 65001");
    system("cls");

    //Fill "map"
    string figuren = "TSLDKLST";

    for (int i = 0; i < 8; i ++){
        for (int j=0; j<8;j++){
            map[i][j]="  ";
        }
    }

    for (int i = 0; i < 8; i ++){
        for (int j=0; j<8;j++){
            if (i % 7 == 0){
                //Türme,Springer,Läufer Links
                map[i][j]=figuren[j];
                //Weiß oder Schwarz?
                if (i==7)
                    map[i][j]='w'+map[i][j];
                else
                    map[i][j]='s'+map[i][j];
            }

            //Bauern
            if ((i==1))
                map[i][j]="sB";
            else if(i==6)
                map[i][j]="wB";
        }
    }




    do{

        //Create "game field"
        int count = 1;
        char count2 = 'a';
        color ++;

        //Change color for every play
        if (color % 2 == 0)
            system("color 03");
        else
            system("color 0a");
        system("cls");

        //Create the lines
        for (int i = 1; i <=8; i++)
            cout << "    " << count2++<<"    ";
        cout << endl;
        cout << "╔";
        for (int i = 1; i <=8; i++)
            cout << boxLines;
        cout << endl;
        for (int b = 0;b <8;b++){
            for (int i = 1; i <3; i++){
                for (int j = 0;j < 8; j++)
                    if (i == 2)
                        cout <<"║"<< "   "<<map[b][j]<<"   ";
                    else
                        cout <<"║"<< "        ";
                cout <<"║";
                if (i==1)
                    cout << " " << count++;
                cout << endl;

            }
            cout << "╠";
            for (int c = 0;c <8;c++)
                cout << "════════╬";
            cout <<endl;
        }

        //Movements
        bool legal=false;
        do {
            cout <<"Bitte Zug eingeben (z.B f1-e3): ";
            cin >> eingabe;
            von = int(eingabe[1])-49;
            von1 = int(eingabe[0])-97;
            nach = int(eingabe[4])-49;
            nach1 = int(eingabe[3])-97;

            //Legal moves detector
            if (von < 8 && von >=0 && von1 < 8 && von1 >=0 && nach < 8 && nach >=0 //Only entries >=0 & <8
                    && nach1 < 8 && nach1 >=0 && map[von][von1]!="  ")             //Only move if there is something to move
                legal = true;
            else if(eingabe=="exit"){
                von=0;von1=0;nach=0;nach1=0;
                legal = true;
                break;
            }
            if(legal && ((map[von][von1][0] == 'w' && color%2 != 0)||(map[von][von1][0] == 's' && color%2 == 0))){
                legal = false;
                cout << "Du bist nicht dran!    \t";
            }
            if(legal && map[von][von1][0] == map[nach][nach1][0]){
                cout << "Verräter!\t\t";
                legal = false;
            }

            ////Some Tests
            //            for (short pos =-8;pos < 9;pos++){
            //                if((map[von][von1]=="sT"||map[von][von1]=="wT")){
            //                    if(map[von+pos][von1]=="  ")
            //                        map [von+pos][von] = " *";
            //                    if(map[von][von1+pos]=="  ")
            //                        map [von][von1+pos] = " *";
            //                }

            //            }

            if (legal == false)
                cout << "Illegal move\n\a";            //"\a" Macht ein beep

        }while(legal == false);

        int anim=0;
        if (map[nach][nach1]=="wK"||map[nach][nach1]=="sK"){
            while (anim < 10) {                  //Schachmatt celebration! (RIP K)
                cout<< "\n\n\n\n\n\n\n\n\n\n\t\t\t\t\t░▒▓▒        Schachmatt!          ░▒▓▒";
                usleep(70000);
                system("color ae");
                system("cls");
                cout<< "\n\n\n\n\n\n\n\n\n\n\t\t\t\t\t▒▓▒░        Schachmatt!          ▒▓▒░";
                usleep(70000);
                system("color d7");
                system("cls");
                cout<< "\n\n\n\n\n\n\n\n\n\n\t\t\t\t\t▓▒░▒        Schachmatt!          ▓▒░▒";
                usleep(70000);
                system("color ae");
                system("cls");
                cout<< "\n\n\n\n\n\n\n\n\n\n\t\t\t\t\t▒▓▒░        Schachmatt!          ▒▓▒░";
                usleep(70000);
                system("color d7");
                system("cls");
                cout<< "\n\n\n\n\n\n\n\n\n\n\t\t\t\t\t░▒▓▒        Schachmatt!          ░▒▓▒";
                usleep(70000);
                system("color ae");
                system("cls");
                cout<< "\n\n\n\n\n\n\n\n\n\n\t\t\t\t\t▒░▒▓        Schachmatt!          ▒░▒▓";
                usleep(70000);
                system("color d7");
                system("cls");
                eingabe = "exit";
                anim++;

            }
            break;
        }
        map[nach][nach1]=map[von][von1];
        map[von][von1]="  ";
    }while(eingabe != "exit");
}
